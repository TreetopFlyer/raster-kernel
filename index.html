<!DOCTYPE html>
<html>
    <head>
        <!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
        <script src="app.js"></script>
        -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    </head>
    <body>
        <div>
            <input type="file">
            <canvas class="In"></canvas>
            <canvas class="Out"></canvas>
        </div>
<script>


var CanvasIn = $("canvas.In").get(0);
var CanvasOut = $("canvas.Out").get(0);
var ContextIn = CanvasIn.getContext('2d');
var ContextOut = CanvasIn.getContext('2d');

$("input[type='file']").change(function(inEvent)
{
    inEvent.stopImmediatePropagation();
    var parser = new FileReader();

    parser.onload = function(inEvent)
    {
        var img;
        img = new Image();
        img.onload = function()
        {
            CanvasIn.width = img.width;
            CanvasIn.height = img.height;
            ContextIn.drawImage(img, 0, 0);

            //////////
            var imageDataIn = ContextIn.getImageData(0, 0, img.width, img.height);
            var vector = obj.BytesToVector(imageDataIn);
            var imageDataOut = obj.VectorToBytes(vector, img.width, img.height);
            CanvasOut.width = img.width;
            CanvasOut.height = img.height;
            ContextOut.putImageData(imageDataOut, 0, 0);
        }
        img.src = parser.result;
    };
    parser.readAsDataURL(inEvent.target.files[0]);
});

function Draw()
{

}

var obj = {};
obj.BytesToVector = function(inBytes)
{
    var out;
    var i;
    out = [];
    for(i=0; i<inBytes.data.length; i+=4)
    {
        out.push(inBytes.data[i]/255);
    }
    return out;
};
obj.VectorToBytes = function(inVector, inWidth, inHeight)
{
    var data;
    data = new Uint8ClampedArray(inWidth*inHeight*4);
    for(i=0; i<inVector.length; i++)
    {
        value = inVector[i]*255;
        data[(i*4)+0] = value;
        data[(i*4)+1] = value;
        data[(i*4)+2] = value;
        data[(i*4)+3] = 255;
    }
    return new ImageData(data, inWidth, inHeight);
};


</script>

    </body>
</html>