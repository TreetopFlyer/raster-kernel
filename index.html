<!DOCTYPE html>
<html>
    <head>
        <!--<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
        <script src="app.js"></script>
        -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    </head>
    <body>
        <div>
            <input type="file">
            <img class="In" src=""/>
            <canvas class="In"></canvas>
            <canvas class="Out"></canvas>
            <img class="Out" src=""/>
        </div>
<script>

var JQ = {
    Input: $("input[type='file']"),
    ImageIn: $("img.In"),
    ImageOut: $("img.Out"),
    CanvasIn: $("canvas.In"),
    CanvasOut: $("canvas.Out")
};

JQ.Input.change(function(inEvent)
{
    inEvent.stopImmediatePropagation();
    var parser = new FileReader();
    parser.onload = function(inEvent)
    {
        JQ.ImageIn.attr("src", parser.result);
    };
    parser.readAsDataURL(inEvent.target.files[0]);
});

JQ.ImageIn.get(0).onload = function()
{
    var jsCanvas, jsImage, jsContext;

    jsCanvas = JQ.CanvasIn.get(0);
    jsImage = JQ.ImageIn.get(0);
    jsContext = jsCanvas.getContext('2d');

    jsCanvas.width = jsImage.width;
    jsCanvas.height = jsImage.height;
    jsContext.drawImage(jsImage, 0, 0);

    //////////
    var imageDataIn = jsContext.getImageData(0, 0, jsCanvas.width, jsCanvas.height);
    var vector = obj.BytesToVector(imageDataIn);
    var imageDataOut = obj.VectorToBytes(vector, jsImage.width, jsImage.height);
    var jsCanvasOut = JQ.CanvasOut.get(0);
    jsCanvasOut.width = jsImage.width;
    jsCanvasOut.height = jsImage.height;
    jsContextOut = jsCanvasOut.getContext('2d');
    jsContextOut.putImageData(imageDataOut, 0, 0);
};

var obj = {};
obj.BytesToVector = function(inBytes)
{
    var out;
    var i;
    out = [];
    for(i=0; i<inBytes.data.length; i+=4)
    {
        out.push(inBytes.data[i]/255);
    }
    return out;
};
obj.VectorToBytes = function(inVector, inWidth, inHeight)
{
    var data;
    data = new Uint8ClampedArray(inWidth*inHeight*4);
    for(i=0; i<inVector.length; i++)
    {
        value = inVector[i]*255;
        data[(i*4)+0] = value;
        data[(i*4)+1] = value;
        data[(i*4)+2] = value;
        data[(i*4)+3] = 255;
    }
    return new ImageData(data, inWidth, inHeight);
};


</script>

    </body>
</html>